<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/2021/04/19/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<span id="more"></span>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>Hexo搭建blogs</title>
    <url>/2021/04/19/hexo%E6%90%AD%E5%BB%BAblogs/</url>
    <content><![CDATA[<h2 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h2><ol>
<li>注册github 账号，建立名为”username.github.io”的仓库</li>
<li>将来你的网址就是：<a href="http://username.github.io">http://username.github.io</a></li>
</ol>
<p>注意：</p>
<ol>
<li>注册的邮箱一定要验证，否则不会成功；</li>
<li>仓库名字必须是：<code>username.github.io</code>，其中<code>username</code>是你的用户名；</li>
<li>仓库创建成功不会立即生效，需要过一段时间才会生效；</li>
</ol>
<span id="more"></span>
<h2 id="准备Git和配置SSH-Key"><a href="#准备Git和配置SSH-Key" class="headerlink" title="准备Git和配置SSH Key"></a>准备Git和配置SSH Key</h2><ol>
<li><p>下载安装<a href="https://gitforwindows.org/">git for windows</a></p>
</li>
<li><p>打开git  bash, 输入：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;邮件地址&quot;</span><br></pre></td></tr></table></figure>
<p>连续三次回车，打开用户目录下 <code>.ssh\id_rsa.pub</code>文件，用记事本打开，复制里面的内容。</p>
</li>
<li><p>打开github主页，进入setting — SSH and GPG keys — New SSH key:</p>
<p>输入刚才复制的内容</p>
</li>
<li><p>打开git  bash, 输入：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>
<p>输入yes，若显示”You’ve successfully authenticated, but GitHub does not provide shell access.“</p>
<p>则表示SSH配置成功。</p>
</li>
</ol>
<h2 id="准备Node-js和Hexo"><a href="#准备Node-js和Hexo" class="headerlink" title="准备Node.js和Hexo"></a>准备Node.js和Hexo</h2><ol>
<li><p>下载安装<a href="https://nodejs.org/en/download/">Node.js</a></p>
<p>打开cmd 输入，验证是否安装成功</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载安装<a href="https://hexo.io/">Hexo</a>，新建一个hexo文件夹，在该文件夹内打开git bash，输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure>
<p>完成后，输入， hexo会自动下载一些文件到这个目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure>
<p>生成、启动服务</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo g #生成</span><br><span class="line">hexo s #启动 打开 http:&#x2F;&#x2F;localhost:4000 即可看到内容</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="上传到github"><a href="#上传到github" class="headerlink" title="上传到github"></a>上传到github</h2><ol>
<li><p>修改配置文件，/hexo/_config.yml，修改deploy部分为：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:liuxianan/liuxianan.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>插件安装</p>
<p>打开git bash，输入：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
</li>
<li><p>上传</p>
<p>打开git bash 输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo d -g</span><br></pre></td></tr></table></figure>
<p>进入：<a href="http://username.github.io">http://username.github.io</a>，即可看到自己的博客页面了</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>next主题代码块复制功能</title>
    <url>/2021/04/19/next%E4%B8%BB%E9%A2%98%E4%BB%A3%E7%A0%81%E5%9D%97%E5%A4%8D%E5%88%B6%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<p><strong>在next主题配置文件<code>_config.yml</code>中，启用 <code>copy_button</code></strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">copy_button:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> </span><br><span class="line">  <span class="comment"># Show text copy result.</span></span><br><span class="line">  <span class="attr">show_result:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Available values: default | flat | mac</span></span><br><span class="line">  <span class="attr">style:</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>next主题搜索功能</title>
    <url>/2021/04/19/next%E4%B8%BB%E9%A2%98%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-search  --save</span><br><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>在hexo站点主配置文件<code>_config.yml</code>,在文件末尾添加</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure>
<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>在next主题配置文件<code>_config.yml</code>中，启用 <code>local_search</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Local search</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># if auto, trigger search by changing input</span></span><br><span class="line">  <span class="comment"># if manual, trigger search by pressing enter key or search button</span></span><br><span class="line">  <span class="attr">trigger:</span> <span class="string">auto</span></span><br><span class="line">  <span class="comment"># show top n results per article, show all results by setting to -1</span></span><br><span class="line">  <span class="attr">top_n_per_article:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>next主题数学公式显示</title>
    <url>/2021/04/19/next%E4%B8%BB%E9%A2%98%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F%E6%98%BE%E7%A4%BA/</url>
    <content><![CDATA[<h2 id="更换渲染引擎"><a href="#更换渲染引擎" class="headerlink" title="更换渲染引擎"></a>更换渲染引擎</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked --save</span><br><span class="line">npm install hexo-renderer-kramed --save</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="修改node-modules-kramed-lib-rules-inline-js文件"><a href="#修改node-modules-kramed-lib-rules-inline-js文件" class="headerlink" title="修改node_modules\kramed\lib\rules\inline.js文件"></a>修改node_modules\kramed\lib\rules\inline.js文件</h2><p>把第11行的escape变量的值做相应的修改：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  escape: /^\\([\\`*&#123;&#125;\[\]()#$+\-.!_&gt;])/,</span></span><br><span class="line">  <span class="built_in">escape</span>: <span class="regexp">/^\\([`*\[\]()#$+\-.!_&gt;])/</span>,</span><br></pre></td></tr></table></figure>
<p>把第20行的em变量做相应的修改：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  em: /^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,</span></span><br><span class="line">  em: <span class="regexp">/^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span>,</span><br></pre></td></tr></table></figure>
<h2 id="在主题中开启mathjax开关"><a href="#在主题中开启mathjax开关" class="headerlink" title="在主题中开启mathjax开关"></a>在主题中开启mathjax开关</h2><p>到博客根目录下，找到<code>themes/next/_config.yml</code>，把<code>math</code>默认的flase修改为true</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Math Equations Render Support</span></span><br><span class="line"><span class="attr">math:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">engine:</span> <span class="string">mathjax</span></span><br></pre></td></tr></table></figure>
<h2 id="更换-mathjax-版本"><a href="#更换-mathjax-版本" class="headerlink" title="更换 mathjax 版本"></a>更换 mathjax 版本</h2><p>在<code>\themes\next\_config.yml</code> 中的 <code>vendors</code> 结点下修改</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mathjax:</span> <span class="string">https://cdn.jsdelivr.net/npm/mathjax@2.7.8/unpacked/MathJax.js?config=TeX-MML-AM_CHTML</span></span><br></pre></td></tr></table></figure>
<h2 id="解决行间公式不渲染问题"><a href="#解决行间公式不渲染问题" class="headerlink" title="解决行间公式不渲染问题"></a>解决行间公式不渲染问题</h2><p>进入<code>\themes\next\layout\_third-party\math\mathjax.swig</code> 进行修改，<code>window.MathJax</code>改为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">window.MathJax &#x3D; &#123;</span><br><span class="line">     tex2jax: &#123;</span><br><span class="line">       inlineMath: [ [&#39;$&#39;,&#39;$&#39;], [&quot;\\(&quot;,&quot;\\)&quot;] ],</span><br><span class="line">       processEscapes: true</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>
<h2 id="在文章的Front-matter里打开mathjax开关"><a href="#在文章的Front-matter里打开mathjax开关" class="headerlink" title="在文章的Front-matter里打开mathjax开关"></a>在文章的Front-matter里打开mathjax开关</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: index.html</span><br><span class="line">date: 2018-12-5 01:30:30</span><br><span class="line">tags:</span><br><span class="line">mathjax: true</span><br><span class="line">--</span><br></pre></td></tr></table></figure>
<h2 id="重新部署Hexo"><a href="#重新部署Hexo" class="headerlink" title="重新部署Hexo"></a>重新部署Hexo</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo g -d  #生成并部署hexo</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>pip换源</title>
    <url>/2021/04/19/pip%E6%8D%A2%E6%BA%90/</url>
    <content><![CDATA[<h2 id="采用国内源，加速下载模块的速度"><a href="#采用国内源，加速下载模块的速度" class="headerlink" title="采用国内源，加速下载模块的速度"></a>采用国内源，加速下载模块的速度</h2><p>1、常用pip源：</p>
<p>— 豆瓣：<a href="https://pypi.douban.com/simple">https://pypi.douban.com/simple</a> </p>
<p>— 阿里：<a href="https://mirrors.aliyun.com/pypi/simple">https://mirrors.aliyun.com/pypi/simple</a> </p>
<p>2、加速安装的命令： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install -i https:&#x2F;&#x2F;pypi.douban.com&#x2F;simple 模块名</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="永久配置安装源"><a href="#永久配置安装源" class="headerlink" title="永久配置安装源"></a><strong>永久配置安装源</strong></h2><p>1、文件管理器文件路径地址栏敲：%APPDATA% 回车，</p>
<p>​        进入 C:\Users\电脑用户\AppData\Roaming 文件夹中 </p>
<p>2、新建 pip 文件夹并在文件夹中新建 pip.ini 配置文件 </p>
<p>3、新增 pip.ini 配置文件内容 </p>
<h2 id="MacOS、Linux"><a href="#MacOS、Linux" class="headerlink" title="MacOS、Linux"></a>MacOS、Linux</h2><p>1、在用户根目录下 ~ 下创建 .pip 隐藏文件夹，如果已经有了可以跳过 — mkdir ~/.pip </p>
<p>2、进入 .pip 隐藏文件夹并创建 pip.conf 配置文件 — cd ~/.pip &amp;&amp; touch pip.conf </p>
<p>3、启动 Finder(访达) 按 cmd+shift+g 来的进入，输入 ~/.pip 回车进入</p>
<p>4、新增 pip.conf 配置文件内容 “””</p>
<h2 id="配置文件内容"><a href="#配置文件内容" class="headerlink" title="配置文件内容"></a>配置文件内容</h2><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">[global] </span><br><span class="line">index-url = http://pypi.douban.com/simple </span><br><span class="line">[install] </span><br><span class="line">use-mirrors =true </span><br><span class="line">mirrors =http://pypi.douban.com/simple/ </span><br><span class="line">trusted-host =pypi.douban.com</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>vs配置opencv</title>
    <url>/2021/04/19/vs%E9%85%8D%E7%BD%AEopencv/</url>
    <content><![CDATA[<h2 id="新建vs属性表文件opencv-props"><a href="#新建vs属性表文件opencv-props" class="headerlink" title="新建vs属性表文件opencv.props"></a>新建vs属性表文件<code>opencv.props</code></h2><p>内容如下，将其中的目录换为你自己的opencv目录即可</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">ToolsVersion</span>=<span class="string">&quot;4.0&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ImportGroup</span> <span class="attr">Label</span>=<span class="string">&quot;PropertySheets&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span> <span class="attr">Label</span>=<span class="string">&quot;UserMacros&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">IncludePath</span>&gt;</span>D:\Dev\opencv\opencv\build\include;$(IncludePath)<span class="tag">&lt;/<span class="name">IncludePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LibraryPath</span>&gt;</span>D:\Dev\opencv\opencv\build\x64\vc15\lib;$(LibraryPath)<span class="tag">&lt;/<span class="name">LibraryPath</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemDefinitionGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Link</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AdditionalDependencies</span>&gt;</span>opencv_world3410d.lib;%(AdditionalDependencies)<span class="tag">&lt;/<span class="name">AdditionalDependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemDefinitionGroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="添加属性表"><a href="#添加属性表" class="headerlink" title="添加属性表"></a>添加属性表</h2><p>将<code>opencv.props</code>拷贝到工程目录下，vs中点击 <code>视图</code> —&gt; <code>其它窗口</code> —&gt; <code>属性窗口</code></p>
<p>在属性窗口中为debug或者release右键添加现有属性表，选择<code>opencv.props</code>文件</p>
<h2 id="添加头文件"><a href="#添加头文件" class="headerlink" title="添加头文件"></a>添加头文件</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgcodecs/imgcodecs.hpp&gt;</span></span></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>光线通信第二章总结</title>
    <url>/2021/04/19/%E5%85%89%E7%BA%A4%E9%80%9A%E4%BF%A1%E7%AC%AC%E4%BA%8C%E7%AB%A0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>公式：</p>
<span id="more"></span>
<script type="math/tex; mode=display">
相对折射率差\quad\triangle = \frac{n_1-n_2}{n_1}\\
数值孔径\quad NA=\sqrt{n_1^2-n_2^2} \approx n_1\sqrt{2\triangle} \\
最大时延差\quad \triangle\tau_{max}=\frac{L}{2n_1c}(NA)^2 \approx \frac{n_1L}{c}\triangle\\
截止波长\quad \lambda_c=\frac{2\pi a\sqrt{n_1^2-n_2^2}}{V_c}=\frac{2\pi aNA}{V_c}\\
单模传输条件\quad V=\frac{2\pi a\sqrt{n_1^2-n_2^2}}{\lambda}\leq2.405\\
\qquad \\
\qquad \\
3dB光纤带宽\quad f_{3dB}=B=\frac{441}{\triangle\tau}\\
光纤损耗系数\quad \alpha=\frac{10}{L}lg\frac{P_i}{P_o}\quad ->\quad \frac{P_i}{P_o}=10^{\frac{\alpha L}{10}}\\
均方根脉冲宽度\quad \quad \sigma=\frac{\triangle\tau}{2.355}\\
带宽距离积\quad =B\times L\\</script>]]></content>
      <categories>
        <category>光纤通信</category>
      </categories>
  </entry>
  <entry>
    <title>常用Hexo命令</title>
    <url>/2021/04/19/%E5%B8%B8%E7%94%A8hexo%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="常见命令"><a href="#常见命令" class="headerlink" title="常见命令"></a>常见命令</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new &quot;postName&quot; #新建文章</span><br><span class="line">hexo new page &quot;pageName&quot; #新建页面</span><br><span class="line">hexo generate #生成静态页面至public目录</span><br><span class="line">hexo server #开启预览访问端口（默认端口4000，&#39;ctrl + c&#39;关闭server）</span><br><span class="line">hexo deploy #部署到GitHub</span><br><span class="line">hexo help  # 查看帮助</span><br><span class="line">hexo version  #查看Hexo的版本</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="缩写形式"><a href="#缩写形式" class="headerlink" title="缩写形式"></a>缩写形式</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo n &#x3D;&#x3D; hexo new</span><br><span class="line">hexo g &#x3D;&#x3D; hexo generate</span><br><span class="line">hexo s &#x3D;&#x3D; hexo server</span><br><span class="line">hexo d &#x3D;&#x3D; hexo deploy</span><br></pre></td></tr></table></figure>
<h2 id="组合命令"><a href="#组合命令" class="headerlink" title="组合命令"></a>组合命令</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo s -g #生成并本地预览</span><br><span class="line">hexo d -g #生成并上传</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
  </entry>
  <entry>
    <title>PyTorch实现所有ResNet</title>
    <url>/2021/04/20/PyTorch%E5%AE%9E%E7%8E%B0%E6%89%80%E6%9C%89ResNet/</url>
    <content><![CDATA[<h2 id="导入所需模块"><a href="#导入所需模块" class="headerlink" title="导入所需模块"></a>导入所需模块</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torchsummary <span class="keyword">import</span> summary</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="基类ResNet和BasicBlock"><a href="#基类ResNet和BasicBlock" class="headerlink" title="基类ResNet和BasicBlock"></a>基类ResNet和BasicBlock</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet, self).__init__()</span><br><span class="line">        self.conv1 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">3</span>, <span class="number">64</span>, kernel_size=<span class="number">7</span>, stride=<span class="number">2</span>, padding=<span class="number">3</span>, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.BatchNorm2d(<span class="number">64</span>),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>),</span><br><span class="line">        )</span><br><span class="line">        self.conv2_x = nn.Sequential()</span><br><span class="line">        self.conv3_x = nn.Sequential()</span><br><span class="line">        self.conv4_x = nn.Sequential()</span><br><span class="line">        self.conv5_x = nn.Sequential()</span><br><span class="line">        self.AvgPool = nn.AdaptiveAvgPool2d((<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">        self.fc = nn.Linear(<span class="number">512</span>, num_classes)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self,x</span>):</span></span><br><span class="line">        out = self.conv1(x)</span><br><span class="line">        out = self.conv2_x(out)</span><br><span class="line">        out = self.conv3_x(out)</span><br><span class="line">        out = self.conv4_x(out)</span><br><span class="line">        out = self.conv5_x(out)</span><br><span class="line">        out = self.AvgPool(out)</span><br><span class="line">        out = out.view(out.size(<span class="number">0</span>), -<span class="number">1</span>)</span><br><span class="line">        out = self.fc(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicBlock</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BasicBlock, self).__init__()</span><br><span class="line">        self.seq = nn.Sequential()</span><br><span class="line">        self.shortcut = nn.Sequential()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        out = self.seq(x)</span><br><span class="line">        out += self.shortcut(x)</span><br><span class="line">        out = F.relu(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h2 id="建立ResNet18-34的BasicBlock"><a href="#建立ResNet18-34的BasicBlock" class="headerlink" title="建立ResNet18-34的BasicBlock"></a>建立ResNet18-34的BasicBlock</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicBlock1</span>(<span class="params">BasicBlock</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, inchannel, outchannel</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BasicBlock1, self).__init__()</span><br><span class="line">        <span class="comment">#直线</span></span><br><span class="line">        self.seq = nn.Sequential(</span><br><span class="line">                    nn.Conv2d(inchannel, outchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(outchannel, outchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                )</span><br><span class="line">        <span class="comment">#实线捷径</span></span><br><span class="line">        </span><br><span class="line">        self.shortcut = nn.Sequential()</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicBlock2</span>(<span class="params">BasicBlock</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, inchannel, outchannel</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BasicBlock2, self).__init__()</span><br><span class="line">         <span class="comment">#直线</span></span><br><span class="line">        self.seq = nn.Sequential(</span><br><span class="line">                nn.Conv2d(inchannel, outchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.BatchNorm2d(outchannel),</span><br><span class="line">                nn.ReLU(),</span><br><span class="line">                nn.Conv2d(outchannel, outchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.BatchNorm2d(outchannel),</span><br><span class="line">            )</span><br><span class="line">            <span class="comment">#虚线捷径</span></span><br><span class="line">        self.shortcut = nn.Sequential(</span><br><span class="line">                nn.Conv2d(inchannel, outchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">2</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.BatchNorm2d(outchannel),</span><br><span class="line">                nn.ReLU(),</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>
<h2 id="ResNet18"><a href="#ResNet18" class="headerlink" title="ResNet18"></a>ResNet18</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet18</span>(<span class="params">ResNet</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet18, self).__init__(num_classes=num_classes)</span><br><span class="line">        <span class="comment">#conv2_x</span></span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">64</span>)</span><br><span class="line">        <span class="comment">#conv3_x</span></span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">64</span>,<span class="number">128</span>)</span><br><span class="line">        <span class="comment">#conv4_x</span></span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">128</span>,<span class="number">256</span>)</span><br><span class="line">        <span class="comment">#conv5_x</span></span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">256</span>,<span class="number">512</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_make_layer</span>(<span class="params">self,inchannel,outchannel,blocks=<span class="number">2</span></span>):</span></span><br><span class="line">        layers = []</span><br><span class="line">        <span class="keyword">if</span> inchannel != outchannel:</span><br><span class="line">            blocks = blocks -<span class="number">1</span></span><br><span class="line">            layers.append(BasicBlock2(inchannel,outchannel))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(blocks):</span><br><span class="line">            layers.append(BasicBlock1(outchannel,outchannel))</span><br><span class="line">        <span class="keyword">return</span> nn.Sequential(*layers)</span><br><span class="line">    </span><br><span class="line">summary(ResNet18(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))</span><br></pre></td></tr></table></figure>
<h2 id="ResNet34"><a href="#ResNet34" class="headerlink" title="ResNet34"></a>ResNet34</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet34</span>(<span class="params">ResNet18</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet18, self).__init__(num_classes=num_classes)</span><br><span class="line">        <span class="comment">#conv2_x</span></span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">64</span>,<span class="number">3</span>)</span><br><span class="line">        <span class="comment">#conv3_x</span></span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">64</span>,<span class="number">128</span>,<span class="number">4</span>)</span><br><span class="line">        <span class="comment">#conv4_x</span></span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">128</span>,<span class="number">256</span>,<span class="number">6</span>)</span><br><span class="line">        <span class="comment">#conv5_x</span></span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">256</span>,<span class="number">512</span>,<span class="number">3</span>)</span><br><span class="line">summary(ResNet34(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))        </span><br></pre></td></tr></table></figure>
<h2 id="建立ResNet50-151的BottleNeck"><a href="#建立ResNet50-151的BottleNeck" class="headerlink" title="建立ResNet50-151的BottleNeck"></a>建立ResNet50-151的BottleNeck</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BottleNeck1</span>(<span class="params">BasicBlock</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,inchannel</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BottleNeck1,self).__init__()</span><br><span class="line">        </span><br><span class="line">        midchannel = inchannel</span><br><span class="line">        inchannel = inchannel*<span class="number">4</span></span><br><span class="line">        outchannel = inchannel</span><br><span class="line">        </span><br><span class="line">        self.seq = nn.Sequential(</span><br><span class="line">                    nn.Conv2d(inchannel, midchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(midchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(midchannel, midchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(midchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(midchannel, outchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.shortcut = nn.Sequential()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BottleNeck2</span>(<span class="params">BasicBlock</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,inchannel</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BottleNeck2,self).__init__()</span><br><span class="line">        </span><br><span class="line">        stride = <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> inchannel != <span class="number">64</span>:</span><br><span class="line">            midchannel = inchannel</span><br><span class="line">            inchannel  = inchannel*<span class="number">2</span></span><br><span class="line">            outchannel = inchannel*<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            inchannel  = inchannel</span><br><span class="line">            midchannel = inchannel</span><br><span class="line">            outchannel = inchannel*<span class="number">4</span></span><br><span class="line">            stride = <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        self.seq = nn.Sequential(</span><br><span class="line">                    nn.Conv2d(inchannel, midchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(midchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(midchannel, midchannel, kernel_size=<span class="number">3</span>, stride=stride, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(midchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(midchannel, outchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">        )</span><br><span class="line">        self.shortcut = nn.Sequential(</span><br><span class="line">                    nn.Conv2d(inchannel, outchannel, kernel_size=<span class="number">1</span>, stride=stride, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">        )</span><br><span class="line">        </span><br></pre></td></tr></table></figure>
<h2 id="ResNet50"><a href="#ResNet50" class="headerlink" title="ResNet50"></a>ResNet50</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet50</span>(<span class="params">ResNet</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet50, self).__init__(num_classes=num_classes)</span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">3</span>)</span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">128</span>,<span class="number">4</span>)</span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">256</span>,<span class="number">6</span>)</span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">512</span>,<span class="number">3</span>)</span><br><span class="line">        self.fc = nn.Linear(<span class="number">2048</span>, num_classes)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_make_layer</span>(<span class="params">self,inchannel,blocks=<span class="number">3</span></span>):</span></span><br><span class="line">        layers = []</span><br><span class="line">        blocks = blocks -<span class="number">1</span></span><br><span class="line">        layers.append(BottleNeck2(inchannel))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(blocks):</span><br><span class="line">            layers.append(BottleNeck1(inchannel))</span><br><span class="line">        <span class="keyword">return</span> nn.Sequential(*layers)</span><br><span class="line">summary(ResNet50(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))</span><br></pre></td></tr></table></figure>
<h2 id="ResNet101"><a href="#ResNet101" class="headerlink" title="ResNet101"></a>ResNet101</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet101</span>(<span class="params">ResNet50</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet101, self).__init__(num_classes=num_classes)</span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">3</span>)</span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">128</span>,<span class="number">4</span>)</span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">256</span>,<span class="number">23</span>)</span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">512</span>,<span class="number">3</span>)</span><br><span class="line">summary(ResNet101(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))</span><br></pre></td></tr></table></figure>
<h2 id="ResNet151"><a href="#ResNet151" class="headerlink" title="ResNet151"></a>ResNet151</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet151</span>(<span class="params">ResNet50</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet151, self).__init__(num_classes=num_classes)</span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">3</span>)</span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">128</span>,<span class="number">8</span>)</span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">256</span>,<span class="number">36</span>)</span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">512</span>,<span class="number">3</span>)</span><br><span class="line">summary(ResNet151(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ResNet</category>
      </categories>
  </entry>
  <entry>
    <title>ResNet详解和实现</title>
    <url>/2021/04/20/ResNet/</url>
    <content><![CDATA[<h2 id="残差神经网络-ResNet"><a href="#残差神经网络-ResNet" class="headerlink" title="残差神经网络(ResNet)"></a>残差神经网络(ResNet)</h2><p>残差神经网络的主要贡献是发现了“退化现象（Degradation）”，并针对退化现象发明了 “快捷连接（Shortcut connection）”，极大的消除了深度过大的神经网络训练困难问题。神经网络的“深度”首次突破了100层、最大的神经网络甚至超过了1000层。</p>
<h2 id="ResNet网络架构"><a href="#ResNet网络架构" class="headerlink" title="ResNet网络架构"></a>ResNet网络架构</h2><p>Shortcut Connection）是ResNet的一大亮点，其实用捷径的方式，使得计算H(x) = F(x)+x，这一改变使得模型的在不断增加深度的情况下，退化也不会非常严重。基本的残差结构如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/drogon-bot12138/blog-images/blog-images/ResNet1.jpg" style="zoom:80%;" /></p>
<span id="more"></span>
<p>论文中，不同深度的残差网络机构如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/drogon-bot12138/blog-images/blog-images/ResNet2.jpg" style="zoom:25%;" /></p>
<h2 id="ResNet详细结构图"><a href="#ResNet详细结构图" class="headerlink" title="ResNet详细结构图"></a>ResNet详细结构图</h2><p>ResNet18和ResNet34是两种不同的残差网络，单看论文里面的结构可能难以理解，更不用说构建了，这里给出了详细的实现图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/drogon-bot12138/blog-images/blog-images/ResNet3.jpg" alt=""></p>
<h2 id="构建基类"><a href="#构建基类" class="headerlink" title="构建基类"></a>构建基类</h2><p>ResNet中，包含两种模块，一种是上图中，旁边伴随有实现的模块，其特点是输入和输出的维度是一致的记为<code>BasicBlock1</code>，另一种是上图中虚线部分的，也就是输入和输出的维度不一样的部分，我们记为<code>BasicBlock2</code></p>
<p>采用面向对象的设计方法，考虑到ResNet中预处理和最后的全连层处理部分都是相同的，即都是把输入为（3，224，224）的图像卷积、池化后变成（64，56，56）的特征向量。因此建立基类<code>ResNet</code></p>
<p>对于模块<code>BasicBlock1</code>、<code>BasicBlock2</code>，我们可以看到其都是具有H(x)=F(x)+x的形式，以此也为其建立基类<code>BasicBlock</code></p>
<h3 id="导入所需模块"><a href="#导入所需模块" class="headerlink" title="导入所需模块"></a>导入所需模块</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> torchsummary <span class="keyword">import</span> summary</span><br></pre></td></tr></table></figure>
<h3 id="构建基类ResNet和BasicBlock"><a href="#构建基类ResNet和BasicBlock" class="headerlink" title="构建基类ResNet和BasicBlock"></a>构建基类ResNet和BasicBlock</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet, self).__init__()</span><br><span class="line">        self.conv1 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">3</span>, <span class="number">64</span>, kernel_size=<span class="number">7</span>, stride=<span class="number">2</span>, padding=<span class="number">3</span>, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.BatchNorm2d(<span class="number">64</span>),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>),</span><br><span class="line">        )</span><br><span class="line">        self.conv2_x = nn.Sequential()</span><br><span class="line">        self.conv3_x = nn.Sequential()</span><br><span class="line">        self.conv4_x = nn.Sequential()</span><br><span class="line">        self.conv5_x = nn.Sequential()</span><br><span class="line">        self.AvgPool = nn.AdaptiveAvgPool2d((<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">        self.fc = nn.Linear(<span class="number">512</span>, num_classes)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self,x</span>):</span></span><br><span class="line">        out = self.conv1(x)</span><br><span class="line">        out = self.conv2_x(out)</span><br><span class="line">        out = self.conv3_x(out)</span><br><span class="line">        out = self.conv4_x(out)</span><br><span class="line">        out = self.conv5_x(out)</span><br><span class="line">        out = self.AvgPool(out)</span><br><span class="line">        out = out.view(out.size(<span class="number">0</span>), -<span class="number">1</span>)</span><br><span class="line">        out = self.fc(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicBlock</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BasicBlock, self).__init__()</span><br><span class="line">        self.seq = nn.Sequential()<span class="comment">#直线</span></span><br><span class="line">        self.shortcut = nn.Sequential()<span class="comment">#捷径</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        out = self.seq(x)</span><br><span class="line">        out += self.shortcut(x)</span><br><span class="line">        out = F.relu(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<h2 id="实现ResNet18-34的两种BasicBlock模块"><a href="#实现ResNet18-34的两种BasicBlock模块" class="headerlink" title="实现ResNet18-34的两种BasicBlock模块"></a>实现ResNet18-34的两种BasicBlock模块</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#类型一，输入、输出维度相同</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicBlock1</span>(<span class="params">BasicBlock</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, inchannel, outchannel</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BasicBlock1, self).__init__()</span><br><span class="line">        <span class="comment">#直线</span></span><br><span class="line">        self.seq = nn.Sequential(</span><br><span class="line">                    nn.Conv2d(inchannel, outchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(outchannel, outchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                )</span><br><span class="line">        <span class="comment">#实线捷径</span></span><br><span class="line">        self.shortcut = nn.Sequential()</span><br><span class="line"></span><br><span class="line"><span class="comment">#类型二，输入、输出维度不同        </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicBlock2</span>(<span class="params">BasicBlock</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, inchannel, outchannel</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BasicBlock2, self).__init__()</span><br><span class="line">         <span class="comment">#直线</span></span><br><span class="line">        self.seq = nn.Sequential(</span><br><span class="line">                nn.Conv2d(inchannel, outchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.BatchNorm2d(outchannel),</span><br><span class="line">                nn.ReLU(),</span><br><span class="line">                nn.Conv2d(outchannel, outchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.BatchNorm2d(outchannel),</span><br><span class="line">            )</span><br><span class="line">            <span class="comment">#虚线捷径</span></span><br><span class="line">        self.shortcut = nn.Sequential(</span><br><span class="line">                nn.Conv2d(inchannel, outchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">2</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.BatchNorm2d(outchannel),</span><br><span class="line">                nn.ReLU(),</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>
<h2 id="ResNet18"><a href="#ResNet18" class="headerlink" title="ResNet18"></a>ResNet18</h2><p>利用<code>BasicBlock</code>、<code>BasicBlock2</code>构建<strong>ResNet18</strong>，其中<code>summary</code>用于查看模型结构</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet18</span>(<span class="params">ResNet</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet18, self).__init__(num_classes=num_classes)</span><br><span class="line">        <span class="comment">#conv2_x</span></span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">64</span>)</span><br><span class="line">        <span class="comment">#conv3_x</span></span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">64</span>,<span class="number">128</span>)</span><br><span class="line">        <span class="comment">#conv4_x</span></span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">128</span>,<span class="number">256</span>)</span><br><span class="line">        <span class="comment">#conv5_x</span></span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">256</span>,<span class="number">512</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_make_layer</span>(<span class="params">self,inchannel,outchannel,blocks=<span class="number">2</span></span>):</span></span><br><span class="line">        layers = []</span><br><span class="line">        <span class="keyword">if</span> inchannel != outchannel:</span><br><span class="line">            blocks = blocks -<span class="number">1</span></span><br><span class="line">            layers.append(BasicBlock2(inchannel,outchannel))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(blocks):</span><br><span class="line">            layers.append(BasicBlock1(outchannel,outchannel))</span><br><span class="line">        <span class="keyword">return</span> nn.Sequential(*layers)</span><br><span class="line">    </span><br><span class="line">summary(ResNet18(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))</span><br></pre></td></tr></table></figure>
<h2 id="ResNet34"><a href="#ResNet34" class="headerlink" title="ResNet34"></a>ResNet34</h2><p>利用<code>ResNet18</code>构建<strong>ResNet34</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet34</span>(<span class="params">ResNet18</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet18, self).__init__(num_classes=num_classes)</span><br><span class="line">        <span class="comment">#conv2_x</span></span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">64</span>,<span class="number">3</span>)</span><br><span class="line">        <span class="comment">#conv3_x</span></span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">64</span>,<span class="number">128</span>,<span class="number">4</span>)</span><br><span class="line">        <span class="comment">#conv4_x</span></span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">128</span>,<span class="number">256</span>,<span class="number">6</span>)</span><br><span class="line">        <span class="comment">#conv5_x</span></span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">256</span>,<span class="number">512</span>,<span class="number">3</span>)</span><br><span class="line">summary(ResNet34(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))        </span><br></pre></td></tr></table></figure>
<h2 id="实现ResNet50-151的两种BottleNeck模块"><a href="#实现ResNet50-151的两种BottleNeck模块" class="headerlink" title="实现ResNet50-151的两种BottleNeck模块"></a>实现ResNet50-151的两种BottleNeck模块</h2><p><code>BottleNeck</code>模块与<code>BasicBlokc</code>模块有所不同，每个模块中包三层卷积层，模块内部有维度的变化，从ResNet50结构图来看，只有第一层的输入维度和卷积参数有所不同，其余模块都是类似的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#维度未发生改变的模块</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BottleNeck1</span>(<span class="params">BasicBlock</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,inchannel</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BottleNeck1,self).__init__()</span><br><span class="line">        </span><br><span class="line">        midchannel = inchannel</span><br><span class="line">        inchannel = inchannel*<span class="number">4</span></span><br><span class="line">        outchannel = inchannel</span><br><span class="line">        </span><br><span class="line">        self.seq = nn.Sequential(</span><br><span class="line">                    nn.Conv2d(inchannel, midchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(midchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(midchannel, midchannel, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(midchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(midchannel, outchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.shortcut = nn.Sequential()</span><br><span class="line"><span class="comment">#维度发生改变的模块</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BottleNeck2</span>(<span class="params">BasicBlock</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,inchannel</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(BottleNeck2,self).__init__()</span><br><span class="line">        </span><br><span class="line">        stride = <span class="number">2</span></span><br><span class="line">        <span class="comment">#对第一层，做特殊处理</span></span><br><span class="line">        <span class="keyword">if</span> inchannel != <span class="number">64</span>:</span><br><span class="line">            midchannel = inchannel</span><br><span class="line">            inchannel  = inchannel*<span class="number">2</span></span><br><span class="line">            outchannel = inchannel*<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            inchannel  = inchannel</span><br><span class="line">            midchannel = inchannel</span><br><span class="line">            outchannel = inchannel*<span class="number">4</span></span><br><span class="line">            stride = <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        self.seq = nn.Sequential(</span><br><span class="line">                    nn.Conv2d(inchannel, midchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(midchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(midchannel, midchannel, kernel_size=<span class="number">3</span>, stride=stride, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(midchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Conv2d(midchannel, outchannel, kernel_size=<span class="number">1</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">        )</span><br><span class="line">        self.shortcut = nn.Sequential(</span><br><span class="line">                    nn.Conv2d(inchannel, outchannel, kernel_size=<span class="number">1</span>, stride=stride, padding=<span class="number">0</span>, bias=<span class="literal">False</span>),</span><br><span class="line">                    nn.BatchNorm2d(outchannel),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h2 id="ResNet50"><a href="#ResNet50" class="headerlink" title="ResNet50"></a>ResNet50</h2><p>利用<code>BottleNeck1</code>、<code>BottleNeck1</code>构建<strong>ResNet50</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet50</span>(<span class="params">ResNet</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet50, self).__init__(num_classes=num_classes)</span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">3</span>)</span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">128</span>,<span class="number">4</span>)</span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">256</span>,<span class="number">6</span>)</span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">512</span>,<span class="number">3</span>)</span><br><span class="line">        self.fc = nn.Linear(<span class="number">2048</span>, num_classes)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_make_layer</span>(<span class="params">self,inchannel,blocks=<span class="number">3</span></span>):</span></span><br><span class="line">        layers = []</span><br><span class="line">        blocks = blocks -<span class="number">1</span></span><br><span class="line">        layers.append(BottleNeck2(inchannel))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(blocks):</span><br><span class="line">            layers.append(BottleNeck1(inchannel))</span><br><span class="line">        <span class="keyword">return</span> nn.Sequential(*layers)</span><br><span class="line">summary(ResNet50(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))</span><br></pre></td></tr></table></figure>
<h2 id="ResNet101"><a href="#ResNet101" class="headerlink" title="ResNet101"></a>ResNet101</h2><p>利用<code>ResNet50</code>构建<strong>ResNet101</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet101</span>(<span class="params">ResNet50</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet101, self).__init__(num_classes=num_classes)</span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">3</span>)</span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">128</span>,<span class="number">4</span>)</span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">256</span>,<span class="number">23</span>)</span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">512</span>,<span class="number">3</span>)</span><br><span class="line">summary(ResNet101(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))</span><br></pre></td></tr></table></figure>
<h2 id="ResNet151"><a href="#ResNet151" class="headerlink" title="ResNet151"></a>ResNet151</h2><p>利用<code>ResNet50</code>构建<strong>ResNet151</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResNet151</span>(<span class="params">ResNet50</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_classes=<span class="number">1000</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ResNet151, self).__init__(num_classes=num_classes)</span><br><span class="line">        self.conv2_x = self._make_layer(<span class="number">64</span>,<span class="number">3</span>)</span><br><span class="line">        self.conv3_x = self._make_layer(<span class="number">128</span>,<span class="number">8</span>)</span><br><span class="line">        self.conv4_x = self._make_layer(<span class="number">256</span>,<span class="number">36</span>)</span><br><span class="line">        self.conv5_x = self._make_layer(<span class="number">512</span>,<span class="number">3</span>)</span><br><span class="line">summary(ResNet151(<span class="number">1000</span>),(<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ResNet</category>
      </categories>
  </entry>
</search>
